drop table if exists t1, t2;
create table t1 (
a int not null auto_increment,
b char(16) not null,
primary key (a),
key (b)
) engine=maria row_format=dynamic;
create table t2(
a int not null auto_increment,
b char(16) not null,
primary key (a),
key (b)
) engine=maria row_format=dynamic;
insert into t1(b) values 
('test0'),
('test1'),
('test2'),
('test3'),
('test4'),
('test5'),
('test6'),
('test7');
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
insert into t2(b) select b from t1;
insert into t1(b) select b from t2;
select count(*) from t1;
count(*)
33448
select count(*) from t2;
count(*)
20672
flush tables;
flush status;
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211388
Maria_pagecache_reads	115
select count(*) from t1 where b = 'test1';
count(*)
4181
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211414
Maria_pagecache_reads	122
select count(*) from t1 where b = 'test1';
count(*)
4181
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211440
Maria_pagecache_reads	122
flush tables;
flush status;
select @@preload_buffer_size;
@@preload_buffer_size
32768
load index into cache t1;
Table	Op	Msg_type	Msg_text
test.t1	preload_keys	status	OK
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211511
Maria_pagecache_reads	193
select count(*) from t1 where b = 'test1';
count(*)
4181
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211537
Maria_pagecache_reads	193
flush tables;
flush status;
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211537
Maria_pagecache_reads	193
set session preload_buffer_size=256*1024;
select @@preload_buffer_size;
@@preload_buffer_size
262144
load index into cache t1 ignore leaves;
Table	Op	Msg_type	Msg_text
test.t1	preload_keys	status	OK
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211608
Maria_pagecache_reads	264
select count(*) from t1 where b = 'test1';
count(*)
4181
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211634
Maria_pagecache_reads	270
flush tables;
flush status;
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211634
Maria_pagecache_reads	270
set session preload_buffer_size=1*1024;
select @@preload_buffer_size;
@@preload_buffer_size
1024
load index into cache t1, t2 key (primary,b) ignore leaves;
Table	Op	Msg_type	Msg_text
test.t1	preload_keys	status	OK
test.t2	preload_keys	status	OK
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211748
Maria_pagecache_reads	384
select count(*) from t1 where b = 'test1';
count(*)
4181
select count(*) from t2 where b = 'test1';
count(*)
2584
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211788
Maria_pagecache_reads	387
flush tables;
flush status;
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211788
Maria_pagecache_reads	387
load index into cache t3, t2 key (primary,b) ;
Table	Op	Msg_type	Msg_text
test.t3	preload_keys	Error	Table 'test.t3' doesn't exist
test.t3	preload_keys	error	Corrupt
test.t2	preload_keys	status	OK
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211831
Maria_pagecache_reads	430
flush tables;
flush status;
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211831
Maria_pagecache_reads	430
load index into cache t3 key (b), t2 key (c) ;
Table	Op	Msg_type	Msg_text
test.t3	preload_keys	Error	Table 'test.t3' doesn't exist
test.t3	preload_keys	error	Corrupt
test.t2	preload_keys	Error	Key 'c' doesn't exist in table 't2'
test.t2	preload_keys	status	Operation failed
show status like "maria_pagecache_read%";
Variable_name	Value
Maria_pagecache_read_requests	211831
Maria_pagecache_reads	430
drop table t1, t2;
show status like "key_read%";
Variable_name	Value
Key_read_requests	0
Key_reads	0
