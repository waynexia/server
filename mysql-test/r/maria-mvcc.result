set global maria_page_checksum=1;
drop table if exists t1;
create table t1 (i int) engine=maria;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `i` int(11) DEFAULT NULL
) ENGINE=MARIA DEFAULT CHARSET=latin1 PAGE_CHECKSUM=1
lock tables t1 write concurrent;
insert into t1 values (1);
insert into t1 values (2);
/* should see 1 and 2 */
select i from t1;
i
1
2
select count(*) from t1;
count(*)
2
/* should see nothing */
select i from t1;
i
select count(*) from t1;
count(*)
0
lock tables t1 write concurrent;
insert into t1 values (3);
insert into t1 values (4);
/* should see 3 and 4 */
select i from t1;
i
3
4
select count(*) from t1;
count(*)
2
unlock tables;
lock tables t1 write concurrent;
insert into t1 values (5);
/* should see 3, 4 and 5 */
select i from t1;
i
3
4
5
select count(*) from t1;
count(*)
3
lock tables t1 write concurrent;
/* should see 3, 4 */
select i from t1;
i
3
4
select count(*) from t1;
count(*)
2
insert into t1 values (6);
/* Should see 1, 2, 6 */
select i from t1;
i
1
2
6
select count(*) from t1;
count(*)
3
unlock tables;
lock tables t1 write concurrent;
/* Should see 1, 2, 3, 4 and 6 */
select i from t1;
i
1
2
3
4
6
select count(*) from t1;
count(*)
5
/* should see 3, 4, 5 */
select i from t1;
i
3
4
5
select count(*) from t1;
count(*)
3
unlock tables;
/* should see 1, 2, 3, 4, 5, 6 */
select i from t1;
i
1
2
3
4
5
6
select count(*) from t1;
count(*)
6
unlock tables;
/* should see 1, 2, 3, 4, 5, 6 */
select i from t1;
i
1
2
3
4
5
6
select count(*) from t1;
count(*)
6
insert into t1 values (7);
/* should see 3, 4, 7 */
select i from t1;
i
3
4
7
select count(*) from t1;
count(*)
3
unlock tables;
/* should see 1, 2, 3, 4, 5, 6, 7 */
select i from t1;
i
1
2
3
4
5
6
7
select count(*) from t1;
count(*)
7
drop table t1;
