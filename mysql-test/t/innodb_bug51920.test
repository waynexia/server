#
# Bug #51920: InnoDB connections in lock wait ignore KILL until timeout
#
-- source include/not_embedded.inc
-- source include/have_innodb.inc

CREATE TABLE bug51920 (i INT) ENGINE=InnoDB;
INSERT INTO bug51920 VALUES (1);

BEGIN;
SELECT * FROM bug51920 FOR UPDATE;

connect (con1,localhost,root,,);

connection con1;
--send
UPDATE bug51920 SET i=2;

connection default;
SELECT ID FROM INFORMATION_SCHEMA.PROCESSLIST
WHERE INFO="UPDATE bug51920 SET i=2"
INTO @thread_id;

KILL @thread_id;
let $wait_condition =
  SELECT COUNT(*)=0 FROM information_schema.processlist WHERE ID=@thread_id;
-- source include/wait_condition.inc

connection con1;
-- error ER_QUERY_INTERRUPTED
reap;
connection default;
DROP TABLE bug51920;
-- disconnect con1
