DROP TABLE IF EXISTS t1;
## Creating new table ##
CREATE TABLE t1
(
id INT NOT NULL AUTO_INCREMENT,
PRIMARY KEY (id),
name VARCHAR(30)
) ENGINE = INNODB;
'#--------------------FN_DYNVARS_017_01-------------------------#'
## Creating new connection ##
INSERT INTO t1(name) VALUES('Record_1');
SET @@autocommit = 0;
SELECT * FROM t1;
id	name
1	Record_1
## Setting value of variable to 0 ##
SET @@session.completion_type = 0;
## Here commit & rollback should work normally ##
START TRANSACTION;
SELECT * FROM t1;
id	name
1	Record_1
INSERT INTO t1(name) VALUES('Record_2');
INSERT INTO t1(name) VALUES('Record_3');
SELECT * FROM t1;
id	name
1	Record_1
2	Record_2
3	Record_3
DELETE FROM t1 WHERE id = 2;
SELECT * FROM t1;
id	name
1	Record_1
3	Record_3
START TRANSACTION;
SELECT * FROM t1;
id	name
1	Record_1
3	Record_3
INSERT INTO t1(name) VALUES('Record_4');
INSERT INTO t1(name) VALUES('Record_5');
COMMIT;
'#--------------------FN_DYNVARS_017_02-------------------------#'
SET @@session.completion_type = 2;
## Here commit should work as COMMIT RELEASE ##
START TRANSACTION;
SELECT * FROM t1;
id	name
1	Record_1
3	Record_3
4	Record_4
5	Record_5
INSERT INTO t1(name) VALUES('Record_6');
INSERT INTO t1(name) VALUES('Record_7');
COMMIT;
## Inserting rows should give error here because connection should ##
## disconnect after using COMMIT ##
INSERT INTO t1(name) VALUES('Record_4');
Got one of the listed errors
## Creating new connection test_con2 ##
SET @@session.completion_type = 2;
## Inserting rows and using Rollback which should Rollback & release ##
START TRANSACTION;
SELECT * FROM t1;
id	name
1	Record_1
3	Record_3
4	Record_4
5	Record_5
6	Record_6
7	Record_7
INSERT INTO t1(name) VALUES('Record_8');
INSERT INTO t1(name) VALUES('Record_9');
ROLLBACK;
INSERT INTO t1(name) VALUES('Record_4');
Got one of the listed errors
DROP TABLE t1;
